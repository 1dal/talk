machine:
  node:
    version: 7
  services:
    - docker
    - redis

test:
  override:
    - npm run lint
    - ./bin/cli settings init
    - sleep 5
    - MOCHA_FILE=junit/test-results.xml NPM_PACKAGE_CONFIG_MOCHA_REPORTER=mocha-junit-reporter npm run test

deployment:
  release:
    tag: /[0-9]+(\.[0-9]+)*/
    commands:
      - bash ./scripts/deploy.sh

  latest:
    branch: master
    commands:
      - bash ./scripts/deploy.sh
